<!DOCTYPE HTML>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Pineko&nbsp;Web&nbsp;Editor</title>
<style>
html {
height: 100%;
width: 100%;
}
body {
height: 100%;
width: 100%
}
textarea {
height: 75%;
width: 80%
margin-left: auto;
margin-right: auto;
}
</head>
<body>
<h1>Pineko&nbsp;Web&nbsp;Editor</h1>
<p>ブラウザで動くテキストエディタ</p>
<form name="test">
<input type="file" id="file"><br>
<textarea id="text" rows="10" cols="40"></textarea>
</form><br>
<input type="text" id="name"><button onclick="save();">Save</button>
<script>
var ele  = document.getElementById('file'); // input要素オブジェクトの取得
 
// ファイルが選択されたら引数の関数を実行
ele.addEventListener("change", function(ev){
    var file = ev.target.files;    // 選択されたファイルはFileListオブジェクトに入り、配列のように扱える
    var reader = new FileReader(); // FileReaderオブジェクトの生成
    reader.readAsText(file[0]);    // 選択されたファイル(fileの先頭要素）を文字列として読み込む
	
    // 読み込みが完了した際に実行される処理
    reader.onload = function(e){
        document.getElementById('text').innerHTML = reader.result;
    }
}, false);

function save() {
      // テキストエリアより文字列を取得
      var text = document.getElementById('text').value;
      var name = document.getElementById('name').value;
      if (!text) { return; }

      // 文字列をBlob化
      var blob = new Blob([text], { type: 'text/plain' });

      // ダウンロード用のaタグ生成
      var a = document.createElement('a');
      a.href =  URL.createObjectURL(blob);
      a.download = name;
      a.click();
    };
</script>
</body>
</html>
